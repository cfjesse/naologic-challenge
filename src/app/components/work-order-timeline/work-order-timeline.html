<div class="timeline-container">
  <!-- Header -->
  <header class="timeline-header">
    <div class="header-content-left">
      <span class="brand">NAO<span class="brand-accent">LOGIC</span></span>
      <h1 class="page-title">Work Orders</h1>

      <div class="main-content-wrapper">
        <div class="timescale-wrapper">
          <div class="timescale-control">
            <ng-select class="timescale-select" [items]="timeScaleOptions" [clearable]="false" [searchable]="false"
              [ngModel]="timeScale" (ngModelChange)="onTimeScaleChange($event)" [title]="'Select timescale'">

              <ng-template ng-label-tmp let-item="item">
                <span class="timescale-label">Timescale</span>
                <span class="timescale-value">{{ item }}</span>
              </ng-template>

              <ng-template ng-option-tmp let-item="item">
                <span class="timescale-option">{{ item }}</span>
              </ng-template>
            </ng-select>
          </div>

          <div class="status-filter-control ms-3">
            <ng-select class="status-select" [items]="statusFilterOptions" [clearable]="false" [searchable]="false"
              [ngModel]="store.statusFilter()" (ngModelChange)="onStatusFilterChange($event)"
              [title]="'Filter by status'">

              <ng-template ng-label-tmp let-item="item">
                <span class="timescale-label">Status</span>
                <span class="timescale-value">{{ item | uppercase }}</span>
              </ng-template>

              <ng-template ng-option-tmp let-item="item">
                <span class="timescale-option">{{ item | uppercase }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
      </div>
    </div>

    <div class="header-content-right">
      <button class="btn-today me-2" (click)="openExport()">Export CSV</button>
      <button class="btn-today" (click)="centerViewportOnToday()">Today</button>
    </div>
  </header>

  <!-- Gantt Grid -->
  <div class="gantt-wrapper" #ganttWrapper (scroll)="onGanttScroll()">
    <!-- Left panel: Work Centers -->
    <div class="left-panel">
      <div class="left-header">
        <span>Work Center</span>
      </div>
      @for (wc of store.workCenters(); track wc.docId) {
      <div class="left-row" [class.even]="$even">
        <span class="wc-name">{{ wc.data.name }}</span>
      </div>
      }
    </div>

    <!-- D3 SVG Chart -->
    <svg #ganttSvg class="gantt-svg"></svg>
  </div>

  @if (activeOrders.length > 0) {
  <app-active-orders-card [activeOrders]="activeOrders" [periodLabel]="cursorPeriodLabel">
  </app-active-orders-card>
  }
</div>

<!-- Tooltip -->
@if (tooltip.visible && auth.isAdmin()) {
<div class="tooltip-popup" [style.top.px]="tooltip.y - 40" [style.left.px]="tooltip.x">
  {{ tooltip.text }}
</div>
}

<!-- Ellipsis Dropdown Menu -->
@if (activeMenu) {
<div class="ellipsis-dropdown" [style.top.px]="activeMenu.y" [style.left.px]="activeMenu.x"
  (mousedown)="$event.stopPropagation()">
  <button class="dropdown-item" (click)="onMenuEdit()">Edit</button>
  <button class="dropdown-item dropdown-item-delete" (click)="onMenuDelete()">Delete</button>
</div>
}

<!-- Confirm Delete Dialog -->
<app-confirm-dialog [visible]="confirmVisible" [title]="'Delete Work Order'"
  [message]="'Are you sure you want to delete this work order? This action cannot be undone.'" [confirmLabel]="'Delete'"
  [cancelLabel]="'Cancel'" [destructive]="true" (confirm)="onConfirmDelete()" (cancel)="onCancelDelete()">
</app-confirm-dialog>